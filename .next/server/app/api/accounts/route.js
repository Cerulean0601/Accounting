(()=>{var e={};e.id=794,e.ids=[794],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1645:e=>{"use strict";e.exports=require("net")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},4631:e=>{"use strict";e.exports=require("tls")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},4075:e=>{"use strict";e.exports=require("zlib")},7598:e=>{"use strict";e.exports=require("node:crypto")},7990:()=>{},9171:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>q,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>d});var u=t(2706),o=t(8203),n=t(5994),i=t(9187),a=t(2545),c=t(5369);async function p(e){let r=c.j.getUserFromRequest(e);if(!r)return i.NextResponse.json({error:"未授權"},{status:401});try{let e=await a.db.cache.get(`accounts:${r.userId}`);if(e)return i.NextResponse.json(e);let t=await a.db.query`
      SELECT account_id, name, type, balance, currency, color, is_active
      FROM accounts 
      WHERE user_id = ${r.userId} AND is_active = true
      ORDER BY name
    `;return await a.db.cache.set(`accounts:${r.userId}`,t.rows,{ex:86400}),i.NextResponse.json(t.rows)}catch(e){return i.NextResponse.json({error:"取得帳戶失敗"},{status:500})}}async function d(e){let r=c.j.getUserFromRequest(e);if(!r)return i.NextResponse.json({error:"未授權"},{status:401});try{let{name:t,type:s,currency:u="TWD",color:o}=await e.json(),n=await a.db.query`
      INSERT INTO accounts (user_id, name, type, currency, color)
      VALUES (${r.userId}, ${t}, ${s}, ${u}, ${o})
      RETURNING account_id, name, type, balance, currency, color
    `;return await a.db.cache.del(`accounts:${r.userId}`),i.NextResponse.json(n.rows[0])}catch(e){return i.NextResponse.json({error:"新增帳戶失敗"},{status:500})}}let l=new u.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/accounts/route",pathname:"/api/accounts",filename:"route",bundlePath:"app/api/accounts/route"},resolvedPagePath:"/mnt/c/Users/xiaoheji/OneDrive - International Games System/文件/GitHub/Accounting/app/api/accounts/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:y,serverHooks:q}=l;function h(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:y})}},6487:()=>{},8335:()=>{},5369:(e,r,t)=>{"use strict";t.d(r,{j:()=>a});var s=t(3008),u=t.n(s),o=t(8964),n=t.n(o);let i=process.env.JWT_SECRET||"your-secret-key",a={hashPassword:e=>n().hash(e,12),verifyPassword:(e,r)=>n().compare(e,r),generateToken:e=>u().sign({userId:e},i,{expiresIn:"7d"}),verifyToken:e=>{try{return u().verify(e,i)}catch{return null}},getUserFromRequest:e=>{let r=e.headers.get("authorization")?.replace("Bearer ","");return r?a.verifyToken(r):null}}},2545:(e,r,t)=>{"use strict";t.d(r,{db:()=>o});var s=t(6875),u=t(3636);let o={query:s.ll,cache:u.kv}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[989,297],()=>t(9171));module.exports=s})();