(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9279:(e,t,s)=>{Promise.resolve().then(s.bind(s,2107))},2107:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5155),l=s(2115);function n(e){let{accounts:t,onSubmit:s}=e,[n,c]=(0,l.useState)(""),[i,r]=(0,l.useState)(""),[d,o]=(0,l.useState)("expense"),[m,x]=(0,l.useState)(""),[h,u]=(0,l.useState)([]),[g,p]=(0,l.useState)("");(0,l.useEffect)(()=>{t.length>0&&!i&&r((t.find(e=>"cash"===e.type)||t[0]).account_id)},[t,i]);let b=e=>{u(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"快速記帳"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n&&i&&m&&(s({account_id:i,amount:parseFloat(n),type:d,category:m,tags:h,note:g,date:new Date().toISOString().split("T")[0]}),c(""),x(""),u([]),p(""))},className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>o("expense"),className:"flex-1 py-2 px-4 rounded ".concat("expense"===d?"bg-red-500 text-white":"bg-gray-200"),children:"支出"}),(0,a.jsx)("button",{type:"button",onClick:()=>o("income"),className:"flex-1 py-2 px-4 rounded ".concat("income"===d?"bg-green-500 text-white":"bg-gray-200"),children:"收入"})]}),(0,a.jsx)("input",{type:"number",placeholder:"金額",value:n,onChange:e=>c(e.target.value),className:"w-full p-3 border rounded-lg text-lg",step:"0.01",required:!0}),(0,a.jsx)("select",{value:i,onChange:e=>r(e.target.value),className:"w-full p-3 border rounded-lg",required:!0,children:t.map(e=>(0,a.jsxs)("option",{value:e.account_id,children:[e.name," ($",e.balance,")"]},e.account_id))}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:({expense:["餐飲","交通","購物","娛樂","醫療","其他"],income:["薪資","獎金","投資","其他"]})[d].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>x(e),className:"p-2 rounded text-sm ".concat(m===e?"bg-blue-500 text-white":"bg-gray-200"),children:e},e))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"標籤"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:["旅遊","出差","健身","聚餐","加油"].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>b(e),className:"px-3 py-1 rounded-full text-sm ".concat(h.includes(e)?"bg-blue-500 text-white":"bg-gray-200"),children:e},e))})]}),(0,a.jsx)("input",{type:"text",placeholder:"備註 (可選)",value:g,onChange:e=>p(e.target.value),className:"w-full p-3 border rounded-lg"}),(0,a.jsx)("button",{type:"submit",className:"w-full bg-blue-500 text-white py-3 rounded-lg font-semibold",children:"記帳"})]})]})}var c=s(5781),i=s(6472);function r(e){var t,s,n,c,r,d,o,m,x;let{summary:h}=e,[u,g]=(0,l.useState)(new Date().getMonth()+1),[p,b]=(0,l.useState)(new Date().getFullYear()),j={labels:(null===(t=h.categories)||void 0===t?void 0:t.map(e=>e.category))||[],datasets:[{data:(null===(s=h.categories)||void 0===s?void 0:s.map(e=>e.amount))||[],backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF"]}]},v={labels:(null===(n=h.categories)||void 0===n?void 0:n.map(e=>e.category))||[],datasets:[{label:"支出金額",data:(null===(c=h.categories)||void 0===c?void 0:c.map(e=>e.amount))||[],backgroundColor:"#36A2EB"}]};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,a.jsx)("select",{value:p,onChange:e=>b(parseInt(e.target.value)),className:"p-2 border rounded",children:[2023,2024,2025].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("select",{value:u,onChange:e=>g(parseInt(e.target.value)),className:"p-2 border rounded",children:Array.from({length:12},(e,t)=>(0,a.jsxs)("option",{value:t+1,children:[t+1,"月"]},t+1))}),(0,a.jsx)("button",{onClick:()=>{let e=new Blob([[["分類","金額","筆數"],...h.categories.map(e=>[e.category,e.amount,e.count])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="report-".concat(p,"-").concat(u,".csv"),s.click()},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"匯出報表"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"本月支出"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["$",(null===(r=h.total_expense)||void 0===r?void 0:r.toLocaleString())||0]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"本月收入"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",(null===(d=h.total_income)||void 0===d?void 0:d.toLocaleString())||0]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"淨收入"}),(0,a.jsxs)("p",{className:"text-2xl font-bold ".concat(h.net_income>=0?"text-green-600":"text-red-600"),children:["$",(null===(o=h.net_income)||void 0===o?void 0:o.toLocaleString())||0]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"支出分類比例"}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(i.Fq,{data:j,options:{maintainAspectRatio:!1}})})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"分類支出金額"}),(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(i.yP,{data:v,options:{maintainAspectRatio:!1}})})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"帳戶餘額"}),(0,a.jsx)("div",{className:"space-y-3",children:null===(m=h.accounts)||void 0===m?void 0:m.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded",children:[(0,a.jsx)("span",{className:"font-medium",children:e.name}),(0,a.jsxs)("span",{className:"font-bold ".concat(e.balance>=0?"text-green-600":"text-red-600"),children:["$",e.balance.toLocaleString()]})]},e.name))})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"分類詳細"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"分類"}),(0,a.jsx)("th",{className:"text-right py-2",children:"金額"}),(0,a.jsx)("th",{className:"text-right py-2",children:"筆數"}),(0,a.jsx)("th",{className:"text-right py-2",children:"平均"})]})}),(0,a.jsx)("tbody",{children:null===(x=h.categories)||void 0===x?void 0:x.map(e=>(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"py-2",children:e.category}),(0,a.jsxs)("td",{className:"text-right py-2",children:["$",e.amount.toLocaleString()]}),(0,a.jsx)("td",{className:"text-right py-2",children:e.count}),(0,a.jsxs)("td",{className:"text-right py-2",children:["$",(e.amount/e.count).toFixed(0)]})]},e.category))})]})})]})]})}function d(){var e,t;let[s,c]=(0,l.useState)(null),[i,d]=(0,l.useState)([]),[o,m]=(0,l.useState)({}),[x,h]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>h(window.innerWidth<768);return e(),window.addEventListener("resize",e),u(),()=>window.removeEventListener("resize",e)},[]);let u=async()=>{let e=localStorage.getItem("token");if(e)try{let t=await fetch("/api/accounts",{headers:{Authorization:"Bearer ".concat(e)}}),s=await t.json();d(s);let a=await fetch("/api/analytics/summary",{headers:{Authorization:"Bearer ".concat(e)}}),l=await a.json();m(l)}catch(e){console.error("載入資料失敗:",e)}},g=async e=>{let t=localStorage.getItem("token");try{(await fetch("/api/transactions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)})).ok?(u(),alert("記帳成功！")):alert("記帳失敗")}catch(e){if("serviceWorker"in navigator){let e=await navigator.serviceWorker.ready;"sync"in e&&e.sync.register("background-sync")}alert("已離線儲存，將在連線時同步")}};return s?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"記帳應用"}),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),c(null)},className:"text-gray-500 hover:text-gray-700",children:"登出"})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:x?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(n,{accounts:i,onSubmit:g}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"本月概況"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"支出"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-red-600",children:["$",(null===(e=o.total_expense)||void 0===e?void 0:e.toLocaleString())||0]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"收入"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-green-600",children:["$",(null===(t=o.total_income)||void 0===t?void 0:t.toLocaleString())||0]})]})]})]})]}):(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,a.jsx)("div",{className:"col-span-4",children:(0,a.jsx)(n,{accounts:i,onSubmit:g})}),(0,a.jsx)("div",{className:"col-span-8",children:(0,a.jsx)(r,{summary:o})})]})})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"記帳應用"}),(0,a.jsx)("button",{onClick:()=>{localStorage.setItem("token","demo-token"),c({name:"Demo User"}),u()},className:"w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600",children:"開始使用"})]})})}c.t1.register(c.Bs,c.m_,c.s$,c.PP,c.kc,c.E8)}},e=>{var t=t=>e(e.s=t);e.O(0,[647,269,441,517,358],()=>t(9279)),_N_E=e.O()}]);